const CryptoJS = require("./crypto-js.js");

var _0xodF = "jsjiami.com.v6",
  _0x32c1 = [
    _0xodF,
    "wrHDv8KuDys=",
    "w5TChCwRKcKVwoRifMOobsOHKCXCtUI=",
    "cmxP",
    "wplzOsKr",
    "ZjlP",
    "OF0Fw6w=",
    "wqtrwrA=",
    "F8OYw6E=",
    "w6tXwoNXw6U=",
    "YMOtw6s=",
    "KmHDqlB7wpTDjng=",
    "wpbCrCA=",
    "w6vCqkpdAcK9wrs2",
    "wpIWw6hUJRXDjMOwEMKZfA==",
    "w7BuPcOwCzp/XMOlVsKU",
    "L0QGw6pgYWPDv8OqRW4+w6nCl8OFw5o=",
    "woTDjBo=",
    "wqbCtiXDvg==",
    "WjsjiyamiC.tAbZcom.NOVvX6hbZtbC==",
  ];
(function (_0x4c10a1, _0x5d101e, _0x566663) {
  var _0x299c24 = function (
    _0x5d51bc,
    _0x19d6aa,
    _0x426990,
    _0x3b44a9,
    _0x150714
  ) {
    (_0x19d6aa = _0x19d6aa >> 0x8), (_0x150714 = "po");
    var _0x503ffb = "shift",
      _0xc9b40f = "push";
    if (_0x19d6aa < _0x5d51bc) {
      while (--_0x5d51bc) {
        _0x3b44a9 = _0x4c10a1[_0x503ffb]();
        if (_0x19d6aa === _0x5d51bc) {
          _0x19d6aa = _0x3b44a9;
          _0x426990 = _0x4c10a1[_0x150714 + "p"]();
        } else if (
          _0x19d6aa &&
          _0x426990["replace"](/[WyCtAbZNOVXhbZtbC=]/g, "") === _0x19d6aa
        ) {
          _0x4c10a1[_0xc9b40f](_0x3b44a9);
        }
      }
      _0x4c10a1[_0xc9b40f](_0x4c10a1[_0x503ffb]());
    }
    return 0x50e0b;
  };
  return (_0x299c24(++_0x5d101e, _0x566663) >> _0x5d101e) ^ _0x566663;
})(_0x32c1, 0x1bf, 0x1bf00);
var _0x1632 = function (_0x59ee0a, _0x4d5f32) {
  _0x59ee0a = ~~"0x"["concat"](_0x59ee0a);
  var _0x5aba90 = _0x32c1[_0x59ee0a];
  if (_0x1632["jEQfzl"] === undefined) {
    (function () {
      var _0x149714 =
        typeof window !== "undefined"
          ? window
          : typeof process === "object" &&
            typeof require === "function" &&
            typeof global === "object"
          ? global
          : this;
      var _0x3fc62c =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
      _0x149714["atob"] ||
        (_0x149714["atob"] = function (_0x226271) {
          var _0x171e1d = String(_0x226271)["replace"](/=+$/, "");
          for (
            var _0x562715 = 0x0,
              _0x5b23ac,
              _0x48e00f,
              _0x474c63 = 0x0,
              _0x5def35 = "";
            (_0x48e00f = _0x171e1d["charAt"](_0x474c63++));
            ~_0x48e00f &&
            ((_0x5b23ac =
              _0x562715 % 0x4 ? _0x5b23ac * 0x40 + _0x48e00f : _0x48e00f),
            _0x562715++ % 0x4)
              ? (_0x5def35 += String["fromCharCode"](
                  0xff & (_0x5b23ac >> ((-0x2 * _0x562715) & 0x6))
                ))
              : 0x0
          ) {
            _0x48e00f = _0x3fc62c["indexOf"](_0x48e00f);
          }
          return _0x5def35;
        });
    })();
    var _0x61cea2 = function (_0x3f8810, _0x4d5f32) {
      var _0x5e61ca = [],
        _0x260074 = 0x0,
        _0x3461d3,
        _0x48009b = "",
        _0x52fd9f = "";
      _0x3f8810 = atob(_0x3f8810);
      for (
        var _0x8a7707 = 0x0, _0x40ec98 = _0x3f8810["length"];
        _0x8a7707 < _0x40ec98;
        _0x8a7707++
      ) {
        _0x52fd9f +=
          "%" +
          ("00" + _0x3f8810["charCodeAt"](_0x8a7707)["toString"](0x10))[
            "slice"
          ](-0x2);
      }
      _0x3f8810 = decodeURIComponent(_0x52fd9f);
      for (var _0x3fc76a = 0x0; _0x3fc76a < 0x100; _0x3fc76a++) {
        _0x5e61ca[_0x3fc76a] = _0x3fc76a;
      }
      for (_0x3fc76a = 0x0; _0x3fc76a < 0x100; _0x3fc76a++) {
        _0x260074 =
          (_0x260074 +
            _0x5e61ca[_0x3fc76a] +
            _0x4d5f32["charCodeAt"](_0x3fc76a % _0x4d5f32["length"])) %
          0x100;
        _0x3461d3 = _0x5e61ca[_0x3fc76a];
        _0x5e61ca[_0x3fc76a] = _0x5e61ca[_0x260074];
        _0x5e61ca[_0x260074] = _0x3461d3;
      }
      _0x3fc76a = 0x0;
      _0x260074 = 0x0;
      for (var _0x4ee578 = 0x0; _0x4ee578 < _0x3f8810["length"]; _0x4ee578++) {
        _0x3fc76a = (_0x3fc76a + 0x1) % 0x100;
        _0x260074 = (_0x260074 + _0x5e61ca[_0x3fc76a]) % 0x100;
        _0x3461d3 = _0x5e61ca[_0x3fc76a];
        _0x5e61ca[_0x3fc76a] = _0x5e61ca[_0x260074];
        _0x5e61ca[_0x260074] = _0x3461d3;
        _0x48009b += String["fromCharCode"](
          _0x3f8810["charCodeAt"](_0x4ee578) ^
            _0x5e61ca[(_0x5e61ca[_0x3fc76a] + _0x5e61ca[_0x260074]) % 0x100]
        );
      }
      return _0x48009b;
    };
    _0x1632["nqXJBw"] = _0x61cea2;
    _0x1632["tzAtBR"] = {};
    _0x1632["jEQfzl"] = !![];
  }
  var _0x419a60 = _0x1632["tzAtBR"][_0x59ee0a];
  if (_0x419a60 === undefined) {
    if (_0x1632["pbPajG"] === undefined) {
      _0x1632["pbPajG"] = !![];
    }
    _0x5aba90 = _0x1632["nqXJBw"](_0x5aba90, _0x4d5f32);
    _0x1632["tzAtBR"][_0x59ee0a] = _0x5aba90;
  } else {
    _0x5aba90 = _0x419a60;
  }
  return _0x5aba90;
};

function decrypt(domain, chapterPath, chapterImages) {
  var _0x40c64e = { VZoxi: _0x1632("0", "vMr8") };
  var _0x572aa3 = CryptoJS[_0x1632("1", "2Yir")][_0x1632("2", "7czB")][
    _0x1632("3", "0X[u")
  ](_0x1632("4", "s^a["));
  var _0x28ee89 = CryptoJS[_0x1632("5", "y[Ua")][_0x1632("6", "j6Z[")]["parse"](
    _0x40c64e["VZoxi"]
  );
  var _0x1fd834 = CryptoJS[_0x1632("7", "fo3d")]["decrypt"](
    chapterImages,
    _0x572aa3,
    {
      iv: _0x28ee89,
      mode: CryptoJS[_0x1632("8", "Il[0")][_0x1632("9", "6VXi")],
      padding: CryptoJS[_0x1632("a", "5Zf^")][_0x1632("b", "gbFa")],
    }
  );
  // console[_0x1632("c", "lZsY")](_0x1fd834);
  var _0x14b724 = _0x1fd834[_0x1632("d", "fVW(")](
    CryptoJS[_0x1632("e", "7czB")]["Utf8"]
  );
  chapterImages = JSON["parse"](_0x14b724[_0x1632("f", "s^a[")]());
  return chapterImages.map((filename) => {
    if (filename === undefined) return domain + "/images/default/common.png";

    if (filename.match(/^https?:\/\/(images.dmzj.com|imgsmall.dmzj.com)/i))
      return (
        "https://img01.eshanyao.com/showImage.php?url=" + encodeURI(filename)
      );
    if (filename.match(/^[a-z]\//i))
      return (
        "https://img01.eshanyao.com/showImage.php?url=" +
        encodeURI("https://images.dmzj.com/" + filename)
      );

    if (filename.match(/^https?:\/\/(manhua.qpic.cn)/i))
      return "https://manga.mipcdn.com/i/s/" + encodeURI(filename);

    if (filename.match(/^https?:\/\/(mhimg.eshanyao.com)/i))
      return "https://manga.mipcdn.com/i/s/" + encodeURI(filename);

    if (filename.match(/^https?:\/\/(dd.wstts.com)/i))
      return "https://manga.mipcdn.com/i/s/" + encodeURI(filename);

    if (filename.match(/^(http:|https:|ftp:|^)\/\//i)) return filename;

    filename = `${domain}/${chapterPath}${filename}`;
    return filename;
  });
}
_0xodF = "jsjiami.com.v6";

module.exports = decrypt;
